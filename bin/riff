#!/usr/bin/env ruby

begin
  # Inspired by http://timelessrepo.com/making-ruby-gems
  begin
    require 'riff'
  rescue LoadError
    $LOAD_PATH.unshift File.join(__dir__, '..', 'lib')
    require 'riff'
  end

  require 'options'
  include Options
  handle_options

  require 'pager'
  include Pager

  refined = Riff.new().do_stream(STDIN)
  page(refined)
rescue => e
  STDERR.puts e.to_s
  STDERR.puts e.backtrace.join("\n\t")
  STDERR.puts
  begin
    STDERR.puts "Riff version #{version}"
  rescue => e
    STDERR.puts 'Also, getting the Riff version failed:'
    STDERR.puts e.to_s
    STDERR.puts e.backtrace.join("\n\t")
  end
  STDERR.puts
  STDERR.puts 'Please report this to https://github.com/walles/riff/issues'
end
